{"version":3,"file":"xallarap.min.js","sources":["../src/modules/parallax-abstract.js","../src/modules/parallax-foreground.js","../src/util/hash.js","../src/util/debounce.js","../src/modules/parallax-background.js","../src/index.js"],"sourcesContent":["\nexport default class Parallax {\n    constructor() {\n        this.compensate = false;\n        this.include = innerHeight;\n        this.hack = (!window.CSS || !CSS.supports || !CSS.supports('will-change', 'transform'));\n        this.reduceMotion = window.matchMedia && matchMedia('(prefers-reduced-motion)').matches;\n    }\n\n    static settings(options, defaultSelector) {\n        const dom = query => document.querySelectorAll(query);\n\n        switch (typeof options.el) {\n            case 'string' :\n                options.el = dom(options.el);\n                break;\n\n            case 'object' :\n                options.el = options.el;\n                break;\n\n            default :\n                options.el = dom(defaultSelector);\n                break;\n        }\n\n        if (NodeList.prototype.isPrototypeOf(options.el)) {\n            options.el = Array.from(options.el);\n        }\n\n        if (!Array.isArray(options.el)) {\n            options.el = [ options.el ];\n        }\n\n        return options;\n    }\n\n    animate() {\n        this.monitor();\n\n        if (this.hasChanged() && this.isVisible()) {\n            this.unchange();\n            this.measure();\n            this.update();\n        }\n\n        requestAnimationFrame(() => {\n            this.animate();\n        });\n    }\n\n    hasChanged() {\n        return this.wtop !== this.pwtop\n            || this.wheight !== this.pwheight\n            || this.top > (this.ptop + 1)\n            || this.top < (this.ptop - 1)\n            || this.height > (this.pheight + 1)\n            || this.height < (this.pheight - 1);\n    }\n\n    unchange() {\n        this.pwtop = this.wtop;\n        this.pwheight = this.wheight;\n        this.ptop = this.top;\n        this.pheight = this.height;\n    }\n\n    monitor() {\n        this.wtop = pageYOffset;\n        this.wheight = innerHeight;\n        this.wbottom = this.wtop + this.wheight;\n        this.top = this.el.getBoundingClientRect().top + this.wtop;\n        this.height = this.el.offsetHeight;\n        this.bottom = this.top + this.height;\n        this.middle = this.top + (this.height / 2);\n    }\n\n    measure() {\n        let scrolled = this.compensate\n            ? (this.wtop / this.wheight)\n            : (this.wtop + (this.wheight / 2) - this.origin()) / (this.height + this.wheight);\n\n        this.margin = (this.boundary < 0)\n            ? Math.abs(this.boundary)\n            : Math.round(this.boundary * (1 - this.height / this.wheight));\n        this.margin += 50;\n        this.parallax = parseFloat((this.boundary * scrolled).toFixed(1));\n\n        if (this.css.setProperty) {\n            this.css.setProperty('--parallax-control', parseFloat(scrolled).toFixed(4));\n        }\n    }\n\n    isVisible() {\n        return this.bottom + this.include > this.wtop && this.top - this.include < this.wbottom;\n    }\n}\n","import Parallax from './parallax-abstract';\n\nclass ParallaxForeground extends Parallax {\n    constructor(el, settings) {\n        super();\n        this.el = el;\n        this.init(settings);\n    }\n\n    init(settings) {\n        if (this.reduceMotion) {\n            return;\n        }\n\n        this.compensate = !!(this.el.dataset.parallaxCompensate === '' || settings.compensate);\n\n        this.boundary = !isNaN(parseInt(this.el.dataset.parallaxAmount))\n            ? parseInt(this.el.dataset.parallaxAmount)\n            : settings.amount || 300;\n\n        if (!!this.boundary) {\n            this.css = this.el.style;\n            this.css.display = 'inline-block';\n            this.css.transition = 'initial';\n            this.css.willChange = 'transform';\n            this.css.transform = this.hack ? 'translate3d(0,0,0)' : 'translateY(0)';\n\n            this.animate();\n        }\n    }\n\n    origin() {\n        return this.middle - (this.parallax || 0);\n    }\n\n    update() {\n        if (this.parallax !== this.pparallax) {\n            this.pparallax = this.parallax;\n            this.hack\n                ? this.css.transform = `translate3d(0,${this.parallax}px,0)`\n                : this.css.transform = `translateY(${this.parallax}px)`;\n        }\n    }\n}\n\nexport default (options = {}) => {\n    const settings = Parallax.settings(options, '[data-parallax]');\n\n    for (let i = 0; i < settings.el.length; ++i) {\n        new ParallaxForeground(settings.el[i], settings);\n    }\n};\n","export default input => {\n\n    let str = input.toString(),\n        len = str.length,\n        hash = 0,\n        chr;\n\n    if (len === 0) {\n        return hash;\n    }\n\n    for (let i = 0; i < len; i++) {\n        chr = str.charCodeAt(i);\n        hash = ((hash << 5) - hash) + chr;\n        hash |= 0;\n    }\n\n    return Math.abs(hash).toString();\n};\n","import hash from './hash';\n\nconst timeouts = [];\n\nexport default (func, wait, ...args) => {\n\n    let key = hash(func),\n\n        bounce = (...pass) => {\n            clearTimeout(timeouts[key]);\n            delete timeouts[key];\n            func(...pass);\n        },\n\n        queue = (...pass) => {\n            clearTimeout(timeouts[key]);\n            timeouts[key] = setTimeout(() => bounce(...pass), wait);\n        };\n\n    if (args.length === 1 && args[0] === 'prepare') {\n        return queue;\n    }\n\n    queue(...args);\n};\n","import Parallax from './parallax-abstract';\nimport debounce from '../util/debounce';\n\nclass ParallaxBackground extends Parallax {\n    constructor(container, settings) {\n        super();\n        this.wrap = container;\n        this.init(settings);\n    }\n\n    init(settings) {\n        let src = (this.wrap.dataset.parallaxBackground || this.wrap.dataset.parallaxBg),\n            bg = getComputedStyle(this.wrap).backgroundImage.replace(/url\\(\"?([^)\"]+)\"?\\)/, '$1');\n\n        if (this.reduceMotion) {\n            if (bg === 'none') {\n                this.wrap.style.backgroundImage = `url(${src})`;\n            }\n\n            return;\n        }\n\n        this.boundary = !isNaN(parseInt(this.wrap.dataset.parallaxAmount))\n            ? parseInt(this.wrap.dataset.parallaxAmount)\n            : settings.amount || Math.round(innerHeight / 2);\n\n        if (!!this.boundary) {\n            this.el = document.createElement('div');\n            this.img = document.createElement('img');\n            this.img.src = src || settings.image || bg;\n            this.css = this.el.style;\n\n            this.css.backgroundImage = `url(${this.img.src})`;\n            this.css.position = this.img.style.position = 'absolute';\n            this.css.top = this.css.left = this.css.right = this.css.bottom = 0;\n            this.css.zIndex = -1;\n            this.css.backgroundSize = 'cover';\n            this.css.backgroundPosition = 'center center';\n            this.css.transition = 'initial';\n            this.css.willChange = 'transform';\n            this.css.transform = this.hack ? 'translate3d(0,0,0)' : 'translateY(0)';\n\n            this.wrap.style.position = 'relative';\n            this.wrap.style.zIndex = 2;\n            this.wrap.style.overflow = 'hidden';\n\n            this.wrap.appendChild(this.el);\n\n            this.img.addEventListener('load', () => {\n                this.img = null;\n\n                this.measure();\n                this.update();\n            });\n\n            window.addEventListener('resize', () => {\n                debounce(() => {\n                    this.measure();\n                    this.update();\n                }, 256);\n            });\n\n            this.animate();\n        }\n    }\n\n    origin() {\n        return this.middle;\n    }\n\n    update() {\n        if (this.margin !== this.pmargin) {\n            let currentMinHeight = parseInt(this.css.minHeight),\n                potentialMinHeight = this.wrap.offsetHeight + this.margin;\n\n            if (isNaN(currentMinHeight) || Math.abs(currentMinHeight - potentialMinHeight) > 5) {\n                this.css.minHeight = `${potentialMinHeight}px`;\n            }\n\n            this.pmargin = this.margin;\n        }\n\n        if (this.parallax !== this.pparallax) {\n            let p = parseFloat((this.parallax - (this.margin / 2)).toFixed(1));\n\n            this.pparallax = this.parallax;\n\n            this.hack\n                ? this.css.transform = `translate3d(0,${p}px,0)`\n                : this.css.transform = `translateY(${p}px)`;\n        }\n    }\n}\n\nexport default (options = {}) => {\n    const settings = Parallax.settings(options, '[data-parallax-background],[data-parallax-bg]');\n\n    for (let i = 0; i < settings.el.length; ++i) {\n        new ParallaxBackground(settings.el[i], settings);\n    }\n};\n","import foreground from './modules/parallax-foreground';\nimport background from './modules/parallax-background';\n\nexport default (options = {}) => {\n    foreground(options.foreground);\n    background(options.background);\n};\n"],"names":["Parallax","constructor","compensate","include","innerHeight","hack","window","CSS","supports","reduceMotion","matchMedia","matches","options","defaultSelector","dom","query","document","querySelectorAll","el","NodeList","prototype","isPrototypeOf","Array","from","isArray","animate","monitor","this","hasChanged","isVisible","unchange","measure","update","requestAnimationFrame","wtop","pwtop","wheight","pwheight","top","ptop","height","pheight","pageYOffset","wbottom","getBoundingClientRect","offsetHeight","bottom","middle","scrolled","origin","margin","boundary","Math","abs","round","parallax","parseFloat","toFixed","css","setProperty","ParallaxForeground","settings","init","dataset","parallaxCompensate","isNaN","parseInt","parallaxAmount","amount","style","display","transition","willChange","transform","pparallax","i","length","input","str","toString","len","hash","charCodeAt","timeouts","ParallaxBackground","container","wrap","src","parallaxBackground","parallaxBg","bg","getComputedStyle","backgroundImage","replace","createElement","img","image","position","left","right","zIndex","backgroundSize","backgroundPosition","overflow","appendChild","addEventListener","func","wait","key","bounce","clearTimeout","queue","pass","setTimeout","args","debounce","pmargin","currentMinHeight","minHeight","potentialMinHeight","p","foreground","background"],"mappings":"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"}