{"version":3,"file":"xallarap.min.js","sources":["../src/modules/parallax-abstract.js","../src/modules/parallax-foreground.js","../src/util/debounce.js","../src/util/hash.js","../src/modules/parallax-background.js","../src/index.js"],"sourcesContent":["\nexport default class Parallax {\n\n    constructor() {\n        this.compensate = false;\n        this.include = innerHeight;\n        this.hack = (!window.CSS || !CSS.supports || !CSS.supports('will-change', 'transform'));\n        this.reduceMotion = window.matchMedia && matchMedia('(prefers-reduced-motion)').matches;\n    }\n\n    static settings(options, defaultSelector) {\n\n        const dom = query => document.querySelectorAll(query);\n\n        switch (typeof options.el) {\n        case 'string' :\n            options.el = dom(options.el);\n            break;\n\n        case 'object' :\n            options.el = options.el;\n            break;\n\n        default :\n            options.el = dom(defaultSelector);\n            break;\n        }\n\n        if (NodeList.prototype.isPrototypeOf(options.el)) {\n            options.el = Array.from(options.el);\n        }\n\n        if (!Array.isArray(options.el)) {\n            options.el = [options.el];\n        }\n\n        return options;\n    }\n\n    animate() {\n        this.monitor();\n\n        if (this.hasChanged() && this.isVisible()) {\n            this.unchange();\n            this.measure();\n            this.update();\n        }\n\n        requestAnimationFrame(() => {\n            this.animate();\n        });\n    }\n\n    hasChanged() {\n        return this.wtop !== this.pwtop\n            || this.wheight !== this.pwheight\n            || this.top > (this.ptop + 1)\n            || this.top < (this.ptop - 1)\n            || this.height > (this.pheight + 1)\n            || this.height < (this.pheight - 1);\n    }\n\n    unchange() {\n        this.pwtop = this.wtop;\n        this.pwheight = this.wheight;\n        this.ptop = this.top;\n        this.pheight = this.height;\n    }\n\n    monitor() {\n        this.wtop = pageYOffset;\n        this.wheight = innerHeight;\n        this.wbottom = this.wtop + this.wheight;\n        this.top = this.el.getBoundingClientRect().top + this.wtop;\n        this.height = this.el.offsetHeight;\n        this.bottom = this.top + this.height;\n    }\n\n    measure() {\n\n        let scrolled = this.compensate\n            ? (this.wtop / this.wheight)\n            : (this.wtop + (this.wheight / 2) - this.origin()) / (this.height + this.wheight);\n\n        this.middle = this.top + (this.height / 2);\n        this.margin = (this.boundary < 0)\n            ? Math.abs(this.boundary)\n            : Math.round(this.boundary * (1 - this.height / this.wheight));\n        this.margin += 50;\n        this.parallax = parseFloat((this.boundary * scrolled).toFixed(1));\n\n        if (this.css.setProperty) {\n            this.css.setProperty('--parallax-control', parseFloat(scrolled).toFixed(2));\n        }\n    }\n\n    isVisible() {\n        return this.bottom + this.include > this.wtop && this.top - this.include < this.wbottom;\n    }\n}\n","import Parallax from './parallax-abstract';\n\nclass ParallaxForeground extends Parallax {\n\n    constructor(el, settings) {\n        super();\n        this.el = el;\n        this.init(settings);\n    }\n\n    init(settings) {\n\n        if (this.reduceMotion) {\n            return;\n        }\n\n        this.compensate = !!(this.el.dataset.parallaxCompensate === '' || settings.compensate);\n\n        this.boundary = !isNaN(parseInt(this.el.dataset.parallaxAmount))\n            ? parseInt(this.el.dataset.parallaxAmount)\n            : settings.amount || 300;\n\n        if (!!this.boundary) {\n            this.css = this.el.style;\n            this.css.display = 'inline-block';\n            this.css.transition = 'initial';\n            this.css.willChange = 'transform';\n            this.css.transform = this.hack ? 'translate3d(0,0,0)' : 'translateY(0)';\n\n            this.animate();\n        }\n    }\n\n    origin() {\n        return this.middle - (this.parallax || 0);\n    }\n\n    update() {\n        if (this.parallax !== this.pparallax) {\n            this.pparallax = this.parallax;\n            this.hack\n                ? this.css.transform = `translate3d(0,${this.parallax}px,0)`\n                : this.css.transform = `translateY(${this.parallax}px)`;\n        }\n    }\n}\n\nexport default (options = {}) => {\n\n    const settings = Parallax.settings(options, '[data-parallax]');\n\n    for (let i = 0; i < settings.el.length; ++i) {\n        new ParallaxForeground(settings.el[i], settings);\n    }\n};\n","import hash from './hash';\n\nconst timeouts = [];\n\nexport default (func, wait, ...args) => {\n\n    let key = hash(func),\n\n        bounce = (...pass) => {\n            clearTimeout(timeouts[key]);\n            delete timeouts[key];\n            func(...pass);\n        },\n\n        queue = (...pass) => {\n            clearTimeout(timeouts[key]);\n            timeouts[key] = setTimeout(() => bounce(...pass), wait);\n        };\n\n    if (args.length === 1 && args[0] === 'prepare') {\n        return queue;\n    }\n\n    queue(...args);\n};\n","export default input => {\n\n    let str = input.toString(),\n        len = str.length,\n        hash = 0,\n        chr;\n\n    if (len === 0) {\n        return hash;\n    }\n\n    for (let i = 0; i < len; i++) {\n        chr = str.charCodeAt(i);\n        hash = ((hash << 5) - hash) + chr;\n        hash |= 0;\n    }\n\n    return Math.abs(hash).toString();\n};\n","import Parallax from './parallax-abstract';\nimport debounce from '../util/debounce';\n\nclass ParallaxBackground extends Parallax {\n\n    constructor(container, settings) {\n        super();\n        this.wrap = container;\n        this.init(settings);\n    }\n\n    init(settings) {\n\n        let src = (this.wrap.dataset.parallaxBackground || this.wrap.dataset.parallaxBg),\n            bg = getComputedStyle(this.wrap).backgroundImage.replace(/url\\(\"?([^)\"]+)\"?\\)/, '$1');\n\n        if (this.reduceMotion) {\n\n            if (bg === 'none') {\n                this.wrap.style.backgroundImage = `url(${src})`;\n            }\n\n            return;\n        }\n\n        this.boundary = !isNaN(parseInt(this.wrap.dataset.parallaxAmount))\n            ? parseInt(this.wrap.dataset.parallaxAmount)\n            : settings.amount || Math.round(innerHeight / 2);\n\n        if (!!this.boundary) {\n\n            this.el = document.createElement('div');\n            this.img = document.createElement('img');\n            this.img.src = src || settings.image || bg;\n            this.css = this.el.style;\n\n            this.css.backgroundImage = `url(${this.img.src})`;\n            this.css.position = this.img.style.position = 'absolute';\n            this.css.top = this.css.left = this.css.right = this.css.bottom = 0;\n            this.css.zIndex = -1;\n            this.css.backgroundSize = 'cover';\n            this.css.backgroundPosition = 'center center';\n            this.css.transition = 'initial';\n            this.css.willChange = 'transform';\n            this.css.transform = this.hack ? 'translate3d(0,0,0)' : 'translateY(0)';\n\n            this.wrap.style.position = 'relative';\n            this.wrap.style.zIndex = 2;\n            this.wrap.style.overflow = 'hidden';\n\n            this.wrap.appendChild(this.el);\n\n            this.img.addEventListener('load', () => {\n\n                this.img = null;\n\n                this.measure();\n                this.update();\n            });\n\n            window.addEventListener('resize', () => {\n                debounce(() => {\n                    this.measure();\n                    this.update();\n                }, 256);\n            });\n\n            this.animate();\n        }\n    }\n\n    origin() {\n        return this.middle;\n    }\n\n    update() {\n\n        if (this.margin !== this.pmargin) {\n            let currentMinHeight = parseInt(this.css.minHeight),\n                potentialMinHeight = this.wrap.offsetHeight + this.margin;\n\n            if (isNaN(currentMinHeight) || Math.abs(currentMinHeight - potentialMinHeight) > 5) {\n                this.css.minHeight = `${potentialMinHeight}px`;\n            }\n\n            this.pmargin = this.margin;\n        }\n\n        if (this.parallax !== this.pparallax) {\n            let p = parseFloat((this.parallax - (this.margin / 2)).toFixed(1));\n\n            this.pparallax = this.parallax;\n\n            this.hack\n                ? this.css.transform = `translate3d(0,${p}px,0)`\n                : this.css.transform = `translateY(${p}px)`;\n        }\n    }\n}\n\nexport default (options = {}) => {\n\n    const settings = Parallax.settings(options, '[data-parallax-background],[data-parallax-bg]');\n\n    for (let i = 0; i < settings.el.length; ++i) {\n        new ParallaxBackground(settings.el[i], settings);\n    }\n};\n","import foreground from './modules/parallax-foreground';\nimport background from './modules/parallax-background';\n\nexport default (options = {}) => {\n    foreground(options.foreground);\n    background(options.background);\n};\n"],"names":["Parallax","compensate","include","innerHeight","hack","window","CSS","supports","reduceMotion","matchMedia","matches","options","defaultSelector","dom","query","document","querySelectorAll","el","NodeList","prototype","isPrototypeOf","Array","from","isArray","monitor","this","hasChanged","isVisible","unchange","measure","update","animate","wtop","pwtop","wheight","pwheight","top","ptop","height","pheight","pageYOffset","wbottom","getBoundingClientRect","offsetHeight","bottom","scrolled","origin","middle","margin","boundary","Math","abs","round","parallax","parseFloat","toFixed","css","setProperty","ParallaxForeground","settings","init","dataset","parallaxCompensate","isNaN","parseInt","parallaxAmount","amount","style","display","transition","willChange","transform","pparallax","timeouts","func","wait","args","key","input","chr","str","toString","len","length","hash","i","charCodeAt","queue","pass","setTimeout","bounce","ParallaxBackground","container","wrap","src","parallaxBackground","parallaxBg","bg","getComputedStyle","backgroundImage","replace","createElement","img","image","position","left","right","zIndex","backgroundSize","backgroundPosition","overflow","appendChild","addEventListener","pmargin","currentMinHeight","minHeight","potentialMinHeight","p","foreground","background"],"mappings":"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"}