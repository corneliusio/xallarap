!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?module.exports=i():"function"==typeof define&&define.amd?define(i):t.xallarap=i()}(this,function(){"use strict";var t=function(){this.compensate=!1,this.hack=!window.CSS||!CSS.supports||!CSS.supports("will-change","transform"),this.reduceMotion=window.matchMedia&&matchMedia("(prefers-reduced-motion)").matches};t.settings=function(t,i){var s=function(t){return document.querySelectorAll(t)};switch(typeof t.el){case"string":t.el=s(t.el);break;case"object":t.el=t.el;break;default:t.el=s(i)}return t},t.prototype.animate=function(){var t=this;this.monitor(),this.hasChanged()&&this.isVisible()&&(this.unchange(),this.measure(),this.update()),requestAnimationFrame(function(){t.animate()})},t.prototype.hasChanged=function(){return this.wtop!==this.pwtop||this.wheight!==this.pwheight||this.top!==this.ptop||this.height!==this.pheight},t.prototype.unchange=function(){this.pwtop=this.wtop,this.pwheight=this.wheight,this.ptop=this.top,this.pheight=this.height},t.prototype.monitor=function(){this.wtop=pageYOffset,this.wheight=innerHeight,this.wbottom=this.wtop+this.wheight,this.top=this.el.getBoundingClientRect().top+this.wtop,this.height=this.el.offsetHeight,this.bottom=this.top+this.height},t.prototype.measure=function(){var t=this.compensate?this.wtop/this.wheight:(this.wtop+this.wheight/2-this.origin())/(this.height+this.wheight);this.middle=this.top+this.height/2,this.margin=this.boundary<0?Math.abs(this.boundary):Math.round(this.boundary*(1-this.height/this.wheight)),this.margin+=100,this.parallax=Math.round(this.boundary*t)},t.prototype.isVisible=function(){return this.bottom+this.include>this.wtop&&this.top-this.include<this.wbottom};var i=function(t){function i(i,s){t.call(this),this.reduceMotion||(this.compensate=!(""!==i.dataset.parallaxCompensate&&!s.compensate),this.boundary=isNaN(parseInt(i.dataset.parallaxAmount))?s.amount||300:parseInt(i.dataset.parallaxAmount),this.include=Math.abs(this.boundary),this.boundary&&(this.el=i,this.css=this.el.style,this.css.display="inline-block",this.css.transition="initial",this.css.willChange="transform",this.css.transform=this.hack?"translate3d(0,0,0)":"translateY(0)",this.animate()))}return t&&(i.__proto__=t),i.prototype=Object.create(t&&t.prototype),i.prototype.constructor=i,i.prototype.origin=function(){return this.middle-(this.parallax||0)},i.prototype.update=function(){this.parallax!==this.pparallax&&(this.pparallax=this.parallax,this.hack?this.css.transform="translate3d(0,"+this.parallax+"px,0)":this.css.transform="translateY("+this.parallax+"px)")},i}(t),s=function(s){void 0===s&&(s={});for(var e=t.settings(s,"[data-parallax]"),a=0;a<e.el.length;++a)new i(e.el[a],e)},e=function(t){var i=t.toString(),s=i.length,e=0;if(0===s)return e;for(var a=0;a<s;a++)e=(e<<5)-e+i.charCodeAt(a),e|=0;return Math.abs(e).toString()},a=[],n=function(t,i){for(var s=[],n=arguments.length-2;n-- >0;)s[n]=arguments[n+2];var h=e(t),r=function(){for(var i=[],s=arguments.length;s--;)i[s]=arguments[s];clearTimeout(a[h]),delete a[h],t.apply(void 0,i)},o=function(){for(var t=[],s=arguments.length;s--;)t[s]=arguments[s];clearTimeout(a[h]),a[h]=setTimeout(function(){return r.apply(void 0,t)},i)};if(1===s.length&&"prepare"===s[0])return o;o.apply(void 0,s)},h=function(t){function i(i,s){var e=this;t.call(this),this.wrap=i;var a=this.wrap.dataset.parallaxBackground||this.wrap.dataset.parallaxBg,h=getComputedStyle(this.wrap).backgroundImage.replace(/url\("?([^)"]+)"?\)/,"$1");this.reduceMotion?"none"===h&&(this.wrap.style.backgroundImage="url("+a+")"):(this.boundary=isNaN(parseInt(this.wrap.dataset.parallaxAmount))?s.amount||Math.round(innerHeight/2):parseInt(this.wrap.dataset.parallaxAmount),this.include=Math.round(innerHeight/2),this.boundary&&(this.el=document.createElement("div"),this.img=document.createElement("img"),this.img.src=a||s.image||h,this.css=this.el.style,this.css.backgroundImage="url("+this.img.src+")",this.css.position=this.img.style.position="absolute",this.css.top=this.css.left=this.css.right=this.css.bottom=0,this.css.zIndex=-1,this.css.backgroundSize="cover",this.css.backgroundPosition="center center",this.css.transition="initial",this.css.willChange="transform",this.css.transform=this.hack?"translate3d(0,0,0)":"translateY(0)",this.wrap.style.position="relative",this.wrap.style.zIndex=2,this.wrap.style.overflow="hidden",this.wrap.appendChild(this.el),this.img.addEventListener("load",function(t){delete e.img,e.measure(),e.update()}),window.addEventListener("resize",function(t){n(function(){e.measure(),e.update()},256)}),this.animate()))}return t&&(i.__proto__=t),i.prototype=Object.create(t&&t.prototype),i.prototype.constructor=i,i.prototype.origin=function(){return this.middle},i.prototype.update=function(){if(this.margin!==this.pmargin&&(this.css.minHeight=this.wrap.offsetHeight+this.margin+"px",this.pmargin=this.margin),this.parallax!==this.pparallax){var t=Math.round(this.parallax-this.margin/2);this.pparallax=this.parallax,this.hack?this.css.transform="translate3d(0,"+t+"px,0)":this.css.transform="translateY("+t+"px)"}},i}(t),r=function(i){void 0===i&&(i={});for(var s=t.settings(i,"[data-parallax-background],[data-parallax-bg]"),e=0;e<s.el.length;++e)new h(s.el[e],s)};return function(t){void 0===t&&(t={}),s(t.foreground),r(t.background)}});